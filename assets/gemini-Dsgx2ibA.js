import{g as tt}from"./index-CTigeR9U.js";var Ne;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(Ne||(Ne={}));var ke;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(ke||(ke={}));var xe;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(xe||(xe={}));const Me=["user","model","function","system"];var Le;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Le||(Le={}));var De;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(De||(De={}));var Fe;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(Fe||(Fe={}));var Ue;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(Ue||(Ue={}));var ge;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(ge||(ge={}));var je;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(je||(je={}));var Ge;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(Ge||(Ge={}));var He;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(He||(He={}));class Y extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class fe extends Y{constructor(t,i){super(t),this.response=i}}class We extends Y{constructor(t,i,r,o){super(t),this.status=i,this.statusText=r,this.errorDetails=o}}class oe extends Y{}class Je extends Y{}const nt="https://generativelanguage.googleapis.com",st="v1beta",it="0.24.1",rt="genai-js";var ce;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(ce||(ce={}));class ot{constructor(t,i,r,o,c){this.model=t,this.task=i,this.apiKey=r,this.stream=o,this.requestOptions=c}toString(){var t,i;const r=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||st;let c=`${((i=this.requestOptions)===null||i===void 0?void 0:i.baseUrl)||nt}/${r}/${this.model}:${this.task}`;return this.stream&&(c+="?alt=sse"),c}}function at(e){const t=[];return e?.apiClient&&t.push(e.apiClient),t.push(`${rt}/${it}`),t.join(" ")}async function ct(e){var t;const i=new Headers;i.append("Content-Type","application/json"),i.append("x-goog-api-client",at(e.requestOptions)),i.append("x-goog-api-key",e.apiKey);let r=(t=e.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(o){throw new oe(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${o.message}`)}for(const[o,c]of r.entries()){if(o==="x-goog-api-key")throw new oe(`Cannot set reserved header name ${o}`);if(o==="x-goog-api-client")throw new oe(`Header name ${o} can only be set using the apiClient field`);i.append(o,c)}}return i}async function ut(e,t,i,r,o,c){const u=new ot(e,t,i,r,c);return{url:u.toString(),fetchOptions:Object.assign(Object.assign({},ht(c)),{method:"POST",headers:await ct(u),body:o})}}async function me(e,t,i,r,o,c={},u=fetch){const{url:p,fetchOptions:A}=await ut(e,t,i,r,o,c);return lt(p,A,u)}async function lt(e,t,i=fetch){let r;try{r=await i(e,t)}catch(o){dt(o,e)}return r.ok||await ft(r,e),r}function dt(e,t){let i=e;throw i.name==="AbortError"?(i=new Je(`Request aborted when fetching ${t.toString()}: ${e.message}`),i.stack=e.stack):e instanceof We||e instanceof oe||(i=new Y(`Error fetching from ${t.toString()}: ${e.message}`),i.stack=e.stack),i}async function ft(e,t){let i="",r;try{const o=await e.json();i=o.error.message,o.error.details&&(i+=` ${JSON.stringify(o.error.details)}`,r=o.error.details)}catch{}throw new We(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${i}`,e.status,e.statusText,r)}function ht(e){const t={};if(e?.signal!==void 0||e?.timeout>=0){const i=new AbortController;e?.timeout>=0&&setTimeout(()=>i.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{i.abort()}),t.signal=i.signal}return t}function we(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Ce(e.candidates[0]))throw new fe(`${re(e)}`,e);return pt(e)}else if(e.promptFeedback)throw new fe(`Text not available. ${re(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Ce(e.candidates[0]))throw new fe(`${re(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),$e(e)[0]}else if(e.promptFeedback)throw new fe(`Function call not available. ${re(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Ce(e.candidates[0]))throw new fe(`${re(e)}`,e);return $e(e)}else if(e.promptFeedback)throw new fe(`Function call not available. ${re(e)}`,e)},e}function pt(e){var t,i,r,o;const c=[];if(!((i=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||i===void 0)&&i.parts)for(const u of(o=(r=e.candidates)===null||r===void 0?void 0:r[0].content)===null||o===void 0?void 0:o.parts)u.text&&c.push(u.text),u.executableCode&&c.push("\n```"+u.executableCode.language+`
`+u.executableCode.code+"\n```\n"),u.codeExecutionResult&&c.push("\n```\n"+u.codeExecutionResult.output+"\n```\n");return c.length>0?c.join(""):""}function $e(e){var t,i,r,o;const c=[];if(!((i=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||i===void 0)&&i.parts)for(const u of(o=(r=e.candidates)===null||r===void 0?void 0:r[0].content)===null||o===void 0?void 0:o.parts)u.functionCall&&c.push(u.functionCall);if(c.length>0)return c}const gt=[ge.RECITATION,ge.SAFETY,ge.LANGUAGE];function Ce(e){return!!e.finishReason&&gt.includes(e.finishReason)}function re(e){var t,i,r;let o="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)o+="Response was blocked",!((t=e.promptFeedback)===null||t===void 0)&&t.blockReason&&(o+=` due to ${e.promptFeedback.blockReason}`),!((i=e.promptFeedback)===null||i===void 0)&&i.blockReasonMessage&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((r=e.candidates)===null||r===void 0)&&r[0]){const c=e.candidates[0];Ce(c)&&(o+=`Candidate was blocked due to ${c.finishReason}`,c.finishMessage&&(o+=`: ${c.finishMessage}`))}return o}function _e(e){return this instanceof _e?(this.v=e,this):new _e(e)}function _t(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(e,t||[]),o,c=[];return o={},u("next"),u("throw"),u("return"),o[Symbol.asyncIterator]=function(){return this},o;function u(S){r[S]&&(o[S]=function(w){return new Promise(function(F,Q){c.push([S,w,F,Q])>1||p(S,w)})})}function p(S,w){try{A(r[S](w))}catch(F){P(c[0][3],F)}}function A(S){S.value instanceof _e?Promise.resolve(S.value.v).then(f,k):P(c[0][2],S)}function f(S){p("next",S)}function k(S){p("throw",S)}function P(S,w){S(w),c.shift(),c.length&&p(c[0][0],c[0][1])}}const Pe=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Et(e){const t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),i=yt(t),[r,o]=i.tee();return{stream:Ct(r),response:mt(o)}}async function mt(e){const t=[],i=e.getReader();for(;;){const{done:r,value:o}=await i.read();if(r)return we(vt(t));t.push(o)}}function Ct(e){return _t(this,arguments,function*(){const i=e.getReader();for(;;){const{value:r,done:o}=yield _e(i.read());if(o)break;yield yield _e(we(r))}})}function yt(e){const t=e.getReader();return new ReadableStream({start(r){let o="";return c();function c(){return t.read().then(({value:u,done:p})=>{if(p){if(o.trim()){r.error(new Y("Failed to parse stream"));return}r.close();return}o+=u;let A=o.match(Pe),f;for(;A;){try{f=JSON.parse(A[1])}catch{r.error(new Y(`Error parsing JSON response: "${A[1]}"`));return}r.enqueue(f),o=o.substring(A[0].length),A=o.match(Pe)}return c()}).catch(u=>{let p=u;throw p.stack=u.stack,p.name==="AbortError"?p=new Je("Request aborted when reading from the stream"):p=new Y("Error reading from the stream"),p})}}})}function vt(e){const t=e[e.length-1],i={promptFeedback:t?.promptFeedback};for(const r of e){if(r.candidates){let o=0;for(const c of r.candidates)if(i.candidates||(i.candidates=[]),i.candidates[o]||(i.candidates[o]={index:o}),i.candidates[o].citationMetadata=c.citationMetadata,i.candidates[o].groundingMetadata=c.groundingMetadata,i.candidates[o].finishReason=c.finishReason,i.candidates[o].finishMessage=c.finishMessage,i.candidates[o].safetyRatings=c.safetyRatings,c.content&&c.content.parts){i.candidates[o].content||(i.candidates[o].content={role:c.content.role||"user",parts:[]});const u={};for(const p of c.content.parts)p.text&&(u.text=p.text),p.functionCall&&(u.functionCall=p.functionCall),p.executableCode&&(u.executableCode=p.executableCode),p.codeExecutionResult&&(u.codeExecutionResult=p.codeExecutionResult),Object.keys(u).length===0&&(u.text=""),i.candidates[o].content.parts.push(u)}o++}r.usageMetadata&&(i.usageMetadata=r.usageMetadata)}return i}async function Qe(e,t,i,r){const o=await me(t,ce.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(i),r);return Et(o)}async function Xe(e,t,i,r){const c=await(await me(t,ce.GENERATE_CONTENT,e,!1,JSON.stringify(i),r)).json();return{response:we(c)}}function Ze(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function Ee(e){let t=[];if(typeof e=="string")t=[{text:e}];else for(const i of e)typeof i=="string"?t.push({text:i}):t.push(i);return Rt(t)}function Rt(e){const t={role:"user",parts:[]},i={role:"function",parts:[]};let r=!1,o=!1;for(const c of e)"functionResponse"in c?(i.parts.push(c),o=!0):(t.parts.push(c),r=!0);if(r&&o)throw new Y("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!o)throw new Y("No content is provided for sending chat message.");return r?t:i}function Ot(e,t){var i;let r={model:t?.model,generationConfig:t?.generationConfig,safetySettings:t?.safetySettings,tools:t?.tools,toolConfig:t?.toolConfig,systemInstruction:t?.systemInstruction,cachedContent:(i=t?.cachedContent)===null||i===void 0?void 0:i.name,contents:[]};const o=e.generateContentRequest!=null;if(e.contents){if(o)throw new oe("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=e.contents}else if(o)r=Object.assign(Object.assign({},r),e.generateContentRequest);else{const c=Ee(e);r.contents=[c]}return{generateContentRequest:r}}function Ke(e){let t;return e.contents?t=e:t={contents:[Ee(e)]},e.systemInstruction&&(t.systemInstruction=Ze(e.systemInstruction)),t}function wt(e){return typeof e=="string"||Array.isArray(e)?{content:Ee(e)}:e}const qe=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],It={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function St(e){let t=!1;for(const i of e){const{role:r,parts:o}=i;if(!t&&r!=="user")throw new Y(`First content should be with role 'user', got ${r}`);if(!Me.includes(r))throw new Y(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(Me)}`);if(!Array.isArray(o))throw new Y("Content should have 'parts' property with an array of Parts");if(o.length===0)throw new Y("Each Content should have at least one part");const c={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const p of o)for(const A of qe)A in p&&(c[A]+=1);const u=It[r];for(const p of qe)if(!u.includes(p)&&c[p]>0)throw new Y(`Content with role '${r}' can't contain '${p}' part`);t=!0}}function Be(e){var t;if(e.candidates===void 0||e.candidates.length===0)return!1;const i=(t=e.candidates[0])===null||t===void 0?void 0:t.content;if(i===void 0||i.parts===void 0||i.parts.length===0)return!1;for(const r of i.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}const Ye="SILENT_ERROR";class bt{constructor(t,i,r,o={}){this.model=i,this.params=r,this._requestOptions=o,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,r?.history&&(St(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,i={}){var r,o,c,u,p,A;await this._sendPromise;const f=Ee(t),k={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(c=this.params)===null||c===void 0?void 0:c.tools,toolConfig:(u=this.params)===null||u===void 0?void 0:u.toolConfig,systemInstruction:(p=this.params)===null||p===void 0?void 0:p.systemInstruction,cachedContent:(A=this.params)===null||A===void 0?void 0:A.cachedContent,contents:[...this._history,f]},P=Object.assign(Object.assign({},this._requestOptions),i);let S;return this._sendPromise=this._sendPromise.then(()=>Xe(this._apiKey,this.model,k,P)).then(w=>{var F;if(Be(w.response)){this._history.push(f);const Q=Object.assign({parts:[],role:"model"},(F=w.response.candidates)===null||F===void 0?void 0:F[0].content);this._history.push(Q)}else{const Q=re(w.response);Q&&console.warn(`sendMessage() was unsuccessful. ${Q}. Inspect response object for details.`)}S=w}).catch(w=>{throw this._sendPromise=Promise.resolve(),w}),await this._sendPromise,S}async sendMessageStream(t,i={}){var r,o,c,u,p,A;await this._sendPromise;const f=Ee(t),k={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(c=this.params)===null||c===void 0?void 0:c.tools,toolConfig:(u=this.params)===null||u===void 0?void 0:u.toolConfig,systemInstruction:(p=this.params)===null||p===void 0?void 0:p.systemInstruction,cachedContent:(A=this.params)===null||A===void 0?void 0:A.cachedContent,contents:[...this._history,f]},P=Object.assign(Object.assign({},this._requestOptions),i),S=Qe(this._apiKey,this.model,k,P);return this._sendPromise=this._sendPromise.then(()=>S).catch(w=>{throw new Error(Ye)}).then(w=>w.response).then(w=>{if(Be(w)){this._history.push(f);const F=Object.assign({},w.candidates[0].content);F.role||(F.role="model"),this._history.push(F)}else{const F=re(w);F&&console.warn(`sendMessageStream() was unsuccessful. ${F}. Inspect response object for details.`)}}).catch(w=>{w.message!==Ye&&console.error(w)}),S}}async function At(e,t,i,r){return(await me(t,ce.COUNT_TOKENS,e,!1,JSON.stringify(i),r)).json()}async function Tt(e,t,i,r){return(await me(t,ce.EMBED_CONTENT,e,!1,JSON.stringify(i),r)).json()}async function Nt(e,t,i,r){const o=i.requests.map(u=>Object.assign(Object.assign({},u),{model:t}));return(await me(t,ce.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),r)).json()}class ze{constructor(t,i,r={}){this.apiKey=t,this._requestOptions=r,i.model.includes("/")?this.model=i.model:this.model=`models/${i.model}`,this.generationConfig=i.generationConfig||{},this.safetySettings=i.safetySettings||[],this.tools=i.tools,this.toolConfig=i.toolConfig,this.systemInstruction=Ze(i.systemInstruction),this.cachedContent=i.cachedContent}async generateContent(t,i={}){var r;const o=Ke(t),c=Object.assign(Object.assign({},this._requestOptions),i);return Xe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},o),c)}async generateContentStream(t,i={}){var r;const o=Ke(t),c=Object.assign(Object.assign({},this._requestOptions),i);return Qe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},o),c)}startChat(t){var i;return new bt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},t),this._requestOptions)}async countTokens(t,i={}){const r=Ot(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),o=Object.assign(Object.assign({},this._requestOptions),i);return At(this.apiKey,this.model,r,o)}async embedContent(t,i={}){const r=wt(t),o=Object.assign(Object.assign({},this._requestOptions),i);return Tt(this.apiKey,this.model,r,o)}async batchEmbedContents(t,i={}){const r=Object.assign(Object.assign({},this._requestOptions),i);return Nt(this.apiKey,this.model,t,r)}}class kt{constructor(t){this.apiKey=t}getGenerativeModel(t,i){if(!t.model)throw new Y("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ze(this.apiKey,t,i)}getGenerativeModelFromCachedContent(t,i,r){if(!t.name)throw new oe("Cached content must contain a `name` field.");if(!t.model)throw new oe("Cached content must contain a `model` field.");const o=["model","systemInstruction"];for(const u of o)if(i?.[u]&&t[u]&&i?.[u]!==t[u]){if(u==="model"){const p=i.model.startsWith("models/")?i.model.replace("models/",""):i.model,A=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(p===A)continue}throw new oe(`Different value for "${u}" specified in modelParams (${i[u]}) and cachedContent (${t[u]})`)}const c=Object.assign(Object.assign({},i),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new ze(this.apiKey,c,r)}}var ye={exports:{}};var xt=ye.exports,Ve;function Mt(){return Ve||(Ve=1,(function(e,t){((i,r)=>{e.exports=r()})(xt,function i(){var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},o,c=!r.document&&!!r.postMessage,u=r.IS_PAPA_WORKER||!1,p={},A=0,f={};function k(n){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(s){var a=ve(s);a.chunkSize=parseInt(a.chunkSize),s.step||s.chunk||(a.chunkSize=null),this._handle=new Q(a),(this._handle.streamer=this)._config=a}).call(this,n),this.parseChunk=function(s,a){var d=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<d){let C=this._config.newline;C||(l=this._config.quoteChar||'"',C=this._handle.guessLineEndings(s,l)),s=[...s.split(C).slice(d)].join(C)}this.isFirstChunk&&T(this._config.beforeFirstChunk)&&(l=this._config.beforeFirstChunk(s))!==void 0&&(s=l),this.isFirstChunk=!1,this._halted=!1;var d=this._partialLine+s,l=(this._partialLine="",this._handle.parse(d,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(s=l.meta.cursor,d=(this._finished||(this._partialLine=d.substring(s-this._baseIndex),this._baseIndex=s),l&&l.data&&(this._rowCount+=l.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),u)r.postMessage({results:l,workerId:f.WORKER_ID,finished:d});else if(T(this._config.chunk)&&!a){if(this._config.chunk(l,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=l=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(l.data),this._completeResults.errors=this._completeResults.errors.concat(l.errors),this._completeResults.meta=l.meta),this._completed||!d||!T(this._config.complete)||l&&l.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),d||l&&l.meta.paused||this._nextChunk(),l}this._halted=!0},this._sendError=function(s){T(this._config.error)?this._config.error(s):u&&this._config.error&&r.postMessage({workerId:f.WORKER_ID,error:s,finished:!1})}}function P(n){var s;(n=n||{}).chunkSize||(n.chunkSize=f.RemoteChunkSize),k.call(this,n),this._nextChunk=c?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(a){this._input=a,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(s=new XMLHttpRequest,this._config.withCredentials&&(s.withCredentials=this._config.withCredentials),c||(s.onload=se(this._chunkLoaded,this),s.onerror=se(this._chunkError,this)),s.open(this._config.downloadRequestBody?"POST":"GET",this._input,!c),this._config.downloadRequestHeaders){var a,d=this._config.downloadRequestHeaders;for(a in d)s.setRequestHeader(a,d[a])}var l;this._config.chunkSize&&(l=this._start+this._config.chunkSize-1,s.setRequestHeader("Range","bytes="+this._start+"-"+l));try{s.send(this._config.downloadRequestBody)}catch(C){this._chunkError(C.message)}c&&s.status===0&&this._chunkError()}},this._chunkLoaded=function(){s.readyState===4&&(s.status<200||400<=s.status?this._chunkError():(this._start+=this._config.chunkSize||s.responseText.length,this._finished=!this._config.chunkSize||this._start>=(a=>(a=a.getResponseHeader("Content-Range"))!==null?parseInt(a.substring(a.lastIndexOf("/")+1)):-1)(s),this.parseChunk(s.responseText)))},this._chunkError=function(a){a=s.statusText||a,this._sendError(new Error(a))}}function S(n){(n=n||{}).chunkSize||(n.chunkSize=f.LocalChunkSize),k.call(this,n);var s,a,d=typeof FileReader<"u";this.stream=function(l){this._input=l,a=l.slice||l.webkitSlice||l.mozSlice,d?((s=new FileReader).onload=se(this._chunkLoaded,this),s.onerror=se(this._chunkError,this)):s=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var l=this._input,C=(this._config.chunkSize&&(C=Math.min(this._start+this._config.chunkSize,this._input.size),l=a.call(l,this._start,C)),s.readAsText(l,this._config.encoding));d||this._chunkLoaded({target:{result:C}})},this._chunkLoaded=function(l){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(l.target.result)},this._chunkError=function(){this._sendError(s.error)}}function w(n){var s;k.call(this,n=n||{}),this.stream=function(a){return s=a,this._nextChunk()},this._nextChunk=function(){var a,d;if(!this._finished)return a=this._config.chunkSize,s=a?(d=s.substring(0,a),s.substring(a)):(d=s,""),this._finished=!s,this.parseChunk(d)}}function F(n){k.call(this,n=n||{});var s=[],a=!0,d=!1;this.pause=function(){k.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){k.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(l){this._input=l,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){d&&s.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),s.length?this.parseChunk(s.shift()):a=!0},this._streamData=se(function(l){try{s.push(typeof l=="string"?l:l.toString(this._config.encoding)),a&&(a=!1,this._checkIsFinished(),this.parseChunk(s.shift()))}catch(C){this._streamError(C)}},this),this._streamError=se(function(l){this._streamCleanUp(),this._sendError(l)},this),this._streamEnd=se(function(){this._streamCleanUp(),d=!0,this._streamData("")},this),this._streamCleanUp=se(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Q(n){var s,a,d,l,C=Math.pow(2,53),j=-C,V=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,W=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,y=this,M=0,g=0,q=!1,E=!1,v=[],h={data:[],errors:[],meta:{}};function G(R){return n.skipEmptyLines==="greedy"?R.join("").trim()==="":R.length===1&&R[0].length===0}function U(){if(h&&d&&(J("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+f.DefaultDelimiter+"'"),d=!1),n.skipEmptyLines&&(h.data=h.data.filter(function(_){return!G(_)})),K()){let _=function(D,H){T(n.transformHeader)&&(D=n.transformHeader(D,H)),v.push(D)};if(h)if(Array.isArray(h.data[0])){for(var R=0;K()&&R<h.data.length;R++)h.data[R].forEach(_);h.data.splice(0,1)}else h.data.forEach(_)}function I(_,D){for(var H=n.header?{}:[],b=0;b<_.length;b++){var N=b,O=_[b],O=((X,m)=>(x=>(n.dynamicTypingFunction&&n.dynamicTyping[x]===void 0&&(n.dynamicTyping[x]=n.dynamicTypingFunction(x)),(n.dynamicTyping[x]||n.dynamicTyping)===!0))(X)?m==="true"||m==="TRUE"||m!=="false"&&m!=="FALSE"&&((x=>{if(V.test(x)&&(x=parseFloat(x),j<x&&x<C))return 1})(m)?parseFloat(m):W.test(m)?new Date(m):m===""?null:m):m)(N=n.header?b>=v.length?"__parsed_extra":v[b]:N,O=n.transform?n.transform(O,N):O);N==="__parsed_extra"?(H[N]=H[N]||[],H[N].push(O)):H[N]=O}return n.header&&(b>v.length?J("FieldMismatch","TooManyFields","Too many fields: expected "+v.length+" fields but parsed "+b,g+D):b<v.length&&J("FieldMismatch","TooFewFields","Too few fields: expected "+v.length+" fields but parsed "+b,g+D)),H}var L;h&&(n.header||n.dynamicTyping||n.transform)&&(L=1,!h.data.length||Array.isArray(h.data[0])?(h.data=h.data.map(I),L=h.data.length):h.data=I(h.data,0),n.header&&h.meta&&(h.meta.fields=v),g+=L)}function K(){return n.header&&v.length===0}function J(R,I,L,_){R={type:R,code:I,message:L},_!==void 0&&(R.row=_),h.errors.push(R)}T(n.step)&&(l=n.step,n.step=function(R){h=R,K()?U():(U(),h.data.length!==0&&(M+=R.data.length,n.preview&&M>n.preview?a.abort():(h.data=h.data[0],l(h,y))))}),this.parse=function(R,I,L){var _=n.quoteChar||'"',_=(n.newline||(n.newline=this.guessLineEndings(R,_)),d=!1,n.delimiter?T(n.delimiter)&&(n.delimiter=n.delimiter(R),h.meta.delimiter=n.delimiter):((_=((D,H,b,N,O)=>{var X,m,x,ie;O=O||[",","	","|",";",f.RECORD_SEP,f.UNIT_SEP];for(var le=0;le<O.length;le++){for(var Z,he=O[le],B=0,ee=0,$=0,z=(x=void 0,new ue({comments:N,delimiter:he,newline:H,preview:10}).parse(D)),ne=0;ne<z.data.length;ne++)b&&G(z.data[ne])?$++:(Z=z.data[ne].length,ee+=Z,x===void 0?x=Z:0<Z&&(B+=Math.abs(Z-x),x=Z));0<z.data.length&&(ee/=z.data.length-$),(m===void 0||B<=m)&&(ie===void 0||ie<ee)&&1.99<ee&&(m=B,X=he,ie=ee)}return{successful:!!(n.delimiter=X),bestDelimiter:X}})(R,n.newline,n.skipEmptyLines,n.comments,n.delimitersToGuess)).successful?n.delimiter=_.bestDelimiter:(d=!0,n.delimiter=f.DefaultDelimiter),h.meta.delimiter=n.delimiter),ve(n));return n.preview&&n.header&&_.preview++,s=R,a=new ue(_),h=a.parse(s,I,L),U(),q?{meta:{paused:!0}}:h||{meta:{paused:!1}}},this.paused=function(){return q},this.pause=function(){q=!0,a.abort(),s=T(n.chunk)?"":s.substring(a.getCharIndex())},this.resume=function(){y.streamer._halted?(q=!1,y.streamer.parseChunk(s,!0)):setTimeout(y.resume,3)},this.aborted=function(){return E},this.abort=function(){E=!0,a.abort(),h.meta.aborted=!0,T(n.complete)&&n.complete(h),s=""},this.guessLineEndings=function(D,_){D=D.substring(0,1048576);var _=new RegExp(ae(_)+"([^]*?)"+ae(_),"gm"),L=(D=D.replace(_,"")).split("\r"),_=D.split(`
`),D=1<_.length&&_[0].length<L[0].length;if(L.length===1||D)return`
`;for(var H=0,b=0;b<L.length;b++)L[b][0]===`
`&&H++;return H>=L.length/2?`\r
`:"\r"}}function ae(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ue(n){var s=(n=n||{}).delimiter,a=n.newline,d=n.comments,l=n.step,C=n.preview,j=n.fastMode,V=null,W=!1,y=n.quoteChar==null?'"':n.quoteChar,M=y;if(n.escapeChar!==void 0&&(M=n.escapeChar),(typeof s!="string"||-1<f.BAD_DELIMITERS.indexOf(s))&&(s=","),d===s)throw new Error("Comment character same as delimiter");d===!0?d="#":(typeof d!="string"||-1<f.BAD_DELIMITERS.indexOf(d))&&(d=!1),a!==`
`&&a!=="\r"&&a!==`\r
`&&(a=`
`);var g=0,q=!1;this.parse=function(E,v,h){if(typeof E!="string")throw new Error("Input must be a string");var G=E.length,U=s.length,K=a.length,J=d.length,R=T(l),I=[],L=[],_=[],D=g=0;if(!E)return B();if(j||j!==!1&&E.indexOf(y)===-1){for(var H=E.split(a),b=0;b<H.length;b++){if(_=H[b],g+=_.length,b!==H.length-1)g+=a.length;else if(h)return B();if(!d||_.substring(0,J)!==d){if(R){if(I=[],ie(_.split(s)),ee(),q)return B()}else ie(_.split(s));if(C&&C<=b)return I=I.slice(0,C),B(!0)}}return B()}for(var N=E.indexOf(s,g),O=E.indexOf(a,g),X=new RegExp(ae(M)+ae(y),"g"),m=E.indexOf(y,g);;)if(E[g]===y)for(m=g,g++;;){if((m=E.indexOf(y,m+1))===-1)return h||L.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:I.length,index:g}),Z();if(m===G-1)return Z(E.substring(g,m).replace(X,y));if(y===M&&E[m+1]===M)m++;else if(y===M||m===0||E[m-1]!==M){N!==-1&&N<m+1&&(N=E.indexOf(s,m+1));var x=le((O=O!==-1&&O<m+1?E.indexOf(a,m+1):O)===-1?N:Math.min(N,O));if(E.substr(m+1+x,U)===s){_.push(E.substring(g,m).replace(X,y)),E[g=m+1+x+U]!==y&&(m=E.indexOf(y,g)),N=E.indexOf(s,g),O=E.indexOf(a,g);break}if(x=le(O),E.substring(m+1+x,m+1+x+K)===a){if(_.push(E.substring(g,m).replace(X,y)),he(m+1+x+K),N=E.indexOf(s,g),m=E.indexOf(y,g),R&&(ee(),q))return B();if(C&&I.length>=C)return B(!0);break}L.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:I.length,index:g}),m++}}else if(d&&_.length===0&&E.substring(g,g+J)===d){if(O===-1)return B();g=O+K,O=E.indexOf(a,g),N=E.indexOf(s,g)}else if(N!==-1&&(N<O||O===-1))_.push(E.substring(g,N)),g=N+U,N=E.indexOf(s,g);else{if(O===-1)break;if(_.push(E.substring(g,O)),he(O+K),R&&(ee(),q))return B();if(C&&I.length>=C)return B(!0)}return Z();function ie($){I.push($),D=g}function le($){var z=0;return z=$!==-1&&($=E.substring(m+1,$))&&$.trim()===""?$.length:z}function Z($){return h||($===void 0&&($=E.substring(g)),_.push($),g=G,ie(_),R&&ee()),B()}function he($){g=$,ie(_),_=[],O=E.indexOf(a,g)}function B($){if(n.header&&!v&&I.length&&!W){var z=I[0],ne=Object.create(null),Re=new Set(z);let Ae=!1;for(let de=0;de<z.length;de++){let te=z[de];if(ne[te=T(n.transformHeader)?n.transformHeader(te,de):te]){let pe,Te=ne[te];for(;pe=te+"_"+Te,Te++,Re.has(pe););Re.add(pe),z[de]=pe,ne[te]++,Ae=!0,(V=V===null?{}:V)[pe]=te}else ne[te]=1,z[de]=te;Re.add(te)}Ae&&console.warn("Duplicate headers found and renamed."),W=!0}return{data:I,errors:L,meta:{delimiter:s,linebreak:a,aborted:q,truncated:!!$,cursor:D+(v||0),renamedHeaders:V}}}function ee(){l(B()),I=[],L=[]}},this.abort=function(){q=!0},this.getCharIndex=function(){return g}}function et(n){var s=n.data,a=p[s.workerId],d=!1;if(s.error)a.userError(s.error,s.file);else if(s.results&&s.results.data){var l={abort:function(){d=!0,Se(s.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:be,resume:be};if(T(a.userStep)){for(var C=0;C<s.results.data.length&&(a.userStep({data:s.results.data[C],errors:s.results.errors,meta:s.results.meta},l),!d);C++);delete s.results}else T(a.userChunk)&&(a.userChunk(s.results,l,s.file),delete s.results)}s.finished&&!d&&Se(s.workerId,s.results)}function Se(n,s){var a=p[n];T(a.userComplete)&&a.userComplete(s),a.terminate(),delete p[n]}function be(){throw new Error("Not implemented.")}function ve(n){if(typeof n!="object"||n===null)return n;var s,a=Array.isArray(n)?[]:{};for(s in n)a[s]=ve(n[s]);return a}function se(n,s){return function(){n.apply(s,arguments)}}function T(n){return typeof n=="function"}return f.parse=function(n,s){var a=(s=s||{}).dynamicTyping||!1;if(T(a)&&(s.dynamicTypingFunction=a,a={}),s.dynamicTyping=a,s.transform=!!T(s.transform)&&s.transform,!s.worker||!f.WORKERS_SUPPORTED)return a=null,f.NODE_STREAM_INPUT,typeof n=="string"?(n=(d=>d.charCodeAt(0)!==65279?d:d.slice(1))(n),a=new(s.download?P:w)(s)):n.readable===!0&&T(n.read)&&T(n.on)?a=new F(s):(r.File&&n instanceof File||n instanceof Object)&&(a=new S(s)),a.stream(n);(a=(()=>{var d;return!!f.WORKERS_SUPPORTED&&(d=(()=>{var l=r.URL||r.webkitURL||null,C=i.toString();return f.BLOB_URL||(f.BLOB_URL=l.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",C,")();"],{type:"text/javascript"})))})(),(d=new r.Worker(d)).onmessage=et,d.id=A++,p[d.id]=d)})()).userStep=s.step,a.userChunk=s.chunk,a.userComplete=s.complete,a.userError=s.error,s.step=T(s.step),s.chunk=T(s.chunk),s.complete=T(s.complete),s.error=T(s.error),delete s.worker,a.postMessage({input:n,config:s,workerId:a.id})},f.unparse=function(n,s){var a=!1,d=!0,l=",",C=`\r
`,j='"',V=j+j,W=!1,y=null,M=!1,g=((()=>{if(typeof s=="object"){if(typeof s.delimiter!="string"||f.BAD_DELIMITERS.filter(function(v){return s.delimiter.indexOf(v)!==-1}).length||(l=s.delimiter),typeof s.quotes!="boolean"&&typeof s.quotes!="function"&&!Array.isArray(s.quotes)||(a=s.quotes),typeof s.skipEmptyLines!="boolean"&&typeof s.skipEmptyLines!="string"||(W=s.skipEmptyLines),typeof s.newline=="string"&&(C=s.newline),typeof s.quoteChar=="string"&&(j=s.quoteChar),typeof s.header=="boolean"&&(d=s.header),Array.isArray(s.columns)){if(s.columns.length===0)throw new Error("Option columns is empty");y=s.columns}s.escapeChar!==void 0&&(V=s.escapeChar+j),s.escapeFormulae instanceof RegExp?M=s.escapeFormulae:typeof s.escapeFormulae=="boolean"&&s.escapeFormulae&&(M=/^[=+\-@\t\r].*$/)}})(),new RegExp(ae(j),"g"));if(typeof n=="string"&&(n=JSON.parse(n)),Array.isArray(n)){if(!n.length||Array.isArray(n[0]))return q(null,n,W);if(typeof n[0]=="object")return q(y||Object.keys(n[0]),n,W)}else if(typeof n=="object")return typeof n.data=="string"&&(n.data=JSON.parse(n.data)),Array.isArray(n.data)&&(n.fields||(n.fields=n.meta&&n.meta.fields||y),n.fields||(n.fields=Array.isArray(n.data[0])?n.fields:typeof n.data[0]=="object"?Object.keys(n.data[0]):[]),Array.isArray(n.data[0])||typeof n.data[0]=="object"||(n.data=[n.data])),q(n.fields||[],n.data||[],W);throw new Error("Unable to serialize unrecognized input");function q(v,h,G){var U="",K=(typeof v=="string"&&(v=JSON.parse(v)),typeof h=="string"&&(h=JSON.parse(h)),Array.isArray(v)&&0<v.length),J=!Array.isArray(h[0]);if(K&&d){for(var R=0;R<v.length;R++)0<R&&(U+=l),U+=E(v[R],R);0<h.length&&(U+=C)}for(var I=0;I<h.length;I++){var L=(K?v:h[I]).length,_=!1,D=K?Object.keys(h[I]).length===0:h[I].length===0;if(G&&!K&&(_=G==="greedy"?h[I].join("").trim()==="":h[I].length===1&&h[I][0].length===0),G==="greedy"&&K){for(var H=[],b=0;b<L;b++){var N=J?v[b]:b;H.push(h[I][N])}_=H.join("").trim()===""}if(!_){for(var O=0;O<L;O++){0<O&&!D&&(U+=l);var X=K&&J?v[O]:O;U+=E(h[I][X],O)}I<h.length-1&&(!G||0<L&&!D)&&(U+=C)}}return U}function E(v,h){var G,U;return v==null?"":v.constructor===Date?JSON.stringify(v).slice(1,25):(U=!1,M&&typeof v=="string"&&M.test(v)&&(v="'"+v,U=!0),G=v.toString().replace(g,V),(U=U||a===!0||typeof a=="function"&&a(v,h)||Array.isArray(a)&&a[h]||((K,J)=>{for(var R=0;R<J.length;R++)if(-1<K.indexOf(J[R]))return!0;return!1})(G,f.BAD_DELIMITERS)||-1<G.indexOf(l)||G.charAt(0)===" "||G.charAt(G.length-1)===" ")?j+G+j:G)}},f.RECORD_SEP="",f.UNIT_SEP="",f.BYTE_ORDER_MARK="\uFEFF",f.BAD_DELIMITERS=["\r",`
`,'"',f.BYTE_ORDER_MARK],f.WORKERS_SUPPORTED=!c&&!!r.Worker,f.NODE_STREAM_INPUT=1,f.LocalChunkSize=10485760,f.RemoteChunkSize=5242880,f.DefaultDelimiter=",",f.Parser=ue,f.ParserHandle=Q,f.NetworkStreamer=P,f.FileStreamer=S,f.StringStreamer=w,f.ReadableStreamStreamer=F,r.jQuery&&((o=r.jQuery).fn.parse=function(n){var s=n.config||{},a=[];return this.each(function(C){if(!(o(this).prop("tagName").toUpperCase()==="INPUT"&&o(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var j=0;j<this.files.length;j++)a.push({file:this.files[j],inputElem:this,instanceConfig:o.extend({},s)})}),d(),this;function d(){if(a.length===0)T(n.complete)&&n.complete();else{var C,j,V,W,y=a[0];if(T(n.before)){var M=n.before(y.file,y.inputElem);if(typeof M=="object"){if(M.action==="abort")return C="AbortError",j=y.file,V=y.inputElem,W=M.reason,void(T(n.error)&&n.error({name:C},j,V,W));if(M.action==="skip")return void l();typeof M.config=="object"&&(y.instanceConfig=o.extend(y.instanceConfig,M.config))}else if(M==="skip")return void l()}var g=y.instanceConfig.complete;y.instanceConfig.complete=function(q){T(g)&&g(q,y.file,y.inputElem),l()},f.parse(y.file,y.instanceConfig)}}function l(){a.splice(0,1),d()}}),u&&(r.onmessage=function(n){n=n.data,f.WORKER_ID===void 0&&n&&(f.WORKER_ID=n.workerId),typeof n.input=="string"?r.postMessage({workerId:f.WORKER_ID,results:f.parse(n.input,n.config),finished:!0}):(r.File&&n.input instanceof File||n.input instanceof Object)&&(n=f.parse(n.input,n.config))&&r.postMessage({workerId:f.WORKER_ID,results:n,finished:!0})}),(P.prototype=Object.create(k.prototype)).constructor=P,(S.prototype=Object.create(k.prototype)).constructor=S,(w.prototype=Object.create(w.prototype)).constructor=w,(F.prototype=Object.create(k.prototype)).constructor=F,f})})(ye)),ye.exports}var Lt=Mt();const Dt=tt(Lt),Ft="AIzaSyC8-bXptWzVUojHP0NNAnkqlE2obDkNSCM";let Oe=null;Oe=new kt(Ft);function Ut(){return localStorage.getItem("selectedModel")||"gemma-3-27b-it"}const Ie=async e=>{if(!Oe)throw new Error("API Key missing");const t=Ut(),i=Oe.getGenerativeModel({model:t});console.log("AI Prompt:",e);try{const o=(await i.generateContent(e)).response.text();return console.log("AI Response:",o),o.replace(/```csv/g,"").replace(/```/g,"").trim()}catch(r){throw console.error("AI Error:",r),r.message?.includes("429")?new Error("Quota Exceeded. Please wait a minute and try again."):r}},jt=(e,t=",")=>Dt.parse(e,{delimiter:t,skipEmptyLines:!0,trimHeaders:!0}).data;async function Ht(e){const t=`
Theme: "${e}"

Task:
Create exactly 4 categories for numeric attributes of items of the given theme.
Each category MUST include either a unit or "out of 10" in brackets if applicable. No explanation.

Format Example:
Top Speed [km/h], Weight [kg], Power [hp], 0-100 Time [s]
`;return(await Ie(t)).split(",").map(c=>c.trim()).map(c=>({name:c,higherWins:!0}))}async function $t(e,t,i=32){const r=`
Task: Generate exactly ${i} unique names of ${e}.
Return a simple line-break separated list. No explanation.

Example:
Item 1
Item 2
Item 3
`;return{cardNames:(await Ie(r)).split(`
`).map(u=>u.replace(/^[\d]+[.)\-]\s*/,"").trim()).filter(u=>u.length>0).slice(0,i)}}async function Pt(e,t,i){const o=`Name,${t.map(k=>k.name).join(",")}`,c=i.map(k=>{const P=new Array(t.length).fill("?").join(",");return`${k},${P}`}).join(`
`),u=`
Theme: "${e}"
Task: Fill in the missing values ('?') in the CSV table below. No explanation.

Rules:
1. Stats: Provide numeric values only for the categories.
2. Return the COMPLETE filled CSV table, keeping the same header and row order.

CSV Template to Fill:
${o}
${c}
`,p=await Ie(u),A=jt(p,","),f=[];for(const k of A){if(k.length<2)continue;const P=k[0]?.trim();if(!P||P==="Name")continue;const S={};t.forEach((w,F)=>{const Q=k[1+F],ae=String(Q).replace(/[^\d.-]/g,""),ue=parseFloat(ae);S[w.name]=isNaN(ue)?0:ue}),f.push({name:P,values:S})}return{cards:f}}export{Pt as generateCardDetails,$t as generateCardNames,Ht as generateCategories,Ut as getSelectedModel};
