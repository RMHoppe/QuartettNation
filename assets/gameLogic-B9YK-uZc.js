function R(y,u,a){let e={...y};const r=e.players.map(n=>({...n,hand:[...n.hand]}));let i=[...e.pot];e.pot=[];const t=u.categories.find(n=>n.name===a),p=t?t.higherWins:!0;let d=r.filter(n=>!n.eliminated);d.length<2&&e.winner;let s=null,m=[],w=[];for(;!s;){const n=d.filter(l=>l.hand.length>0);if(n.length===0)break;if(n.length===1){s=n[0];break}d=n;const o=d.map(l=>{const c=l.hand[0],v=c.attributes?c.attributes[a]:c.values?c.values[a]:0,N=parseFloat(v)||0;return{playerId:l.id,playerName:l.name,card:c,value:N,playerRef:l}}),I=o.map(l=>l.card);i.push(...I),o.forEach(l=>{l.playerRef.hand.shift()});const P=p?1:-1;o.sort((l,c)=>(c.value-l.value)*P);const g=o[0].value,h=o.filter(l=>l.value===g);m=o,w.push({winner:h.length===1?h[0].playerId:null,cardsPlayed:o.map(l=>({playerId:l.playerId,playerName:l.playerName,card:l.card,value:l.value}))}),h.length===1?s=h[0].playerRef:d=h.map(l=>l.playerRef)}s?(s.hand.push(...i),e.warMode=!1,e.warParticipants=null,e.turnPlayerId=s.id,e.lastRound={category:a,winner:s.id,winnerName:s.name,warHistory:w,cardsPlayed:m.map(n=>({playerId:n.playerId,playerName:n.playerName,card:n.card}))}):(e.warMode=!1,e.turnPlayerId=null,e.lastRound={category:a,winner:null,winnerName:null,warHistory:w,cardsPlayed:m.map(n=>({playerId:n.playerId,playerName:n.playerName,card:n.card}))}),e.players=r,e.pot=[],e.players.forEach(n=>{n.hand.length===0&&(n.eliminated=!0)});const f=e.players.filter(n=>!n.eliminated);return f.length===1?(e.winner=f[0],e.status="completed"):f.length===0&&(e.status="completed",e.winner={name:"No One (Draw)"}),e.status!=="completed"&&(!e.turnPlayerId||e.players.find(n=>n.id===e.turnPlayerId)?.eliminated)&&(e.turnPlayerId=f[0]?.id),e}function b(y,u){const a=[...u];for(let t=a.length-1;t>0;t--){const p=Math.floor(Math.random()*(t+1));[a[t],a[p]]=[a[p],a[t]]}const e=y.map(t=>({...t,hand:[],cardsWon:[],eliminated:!1})),r=Math.floor(a.length/e.length);e.forEach((t,p)=>{const d=p*r,s=d+r;t.hand=a.slice(d,s)});const i=a.slice(e.length*r);return{players:e,pot:i,turnPlayerId:e[0].id,warMode:!1,lastRound:null,winner:null,status:"active"}}function M(y,u){let a={...y};const e=a.players.findIndex(t=>t.id===u);if(e===-1)return a;const r={...a.players[e]};a.pot=[...a.pot,...r.hand],r.hand=[],r.eliminated=!0,a.players=[...a.players],a.players[e]=r;const i=a.players.filter(t=>!t.eliminated);return i.length===1&&(a.winner=i[0],a.status="completed"),a.turnPlayerId===u&&a.status!=="completed"&&(a.turnPlayerId=i[0]?.id),a}export{M as concedePlayer,b as initializeGame,R as resolveRound};
